#!/bin/bash

# UserPromptSubmit Hook - Injects active persona into user prompts

# Check for active persona (local first, then global)
if [ -f ".claude/state/current-persona" ]; then
    current_persona=$(cat ".claude/state/current-persona")
elif [ -f "$HOME/.claude/state/current-persona" ]; then
    current_persona=$(cat "$HOME/.claude/state/current-persona")
else
    exit 0
fi

# Find persona file (local first, then global)
if [ -f ".claude/personas/$current_persona.md" ]; then
    persona_file=".claude/personas/$current_persona.md"
elif [ -f "$HOME/.claude/personas/$current_persona.md" ]; then
    persona_file="$HOME/.claude/personas/$current_persona.md"
else
    echo "Warning: Active persona '$current_persona' file not found" >&2
    exit 0
fi

# Read and inject persona content
persona_content=$(cat "$persona_file")

echo "<system-reminder>"
echo "ACTIVE PERSONA: $current_persona"
echo ""
echo "$persona_content"
echo "</system-reminder>"
echo ""
echo "User request:"